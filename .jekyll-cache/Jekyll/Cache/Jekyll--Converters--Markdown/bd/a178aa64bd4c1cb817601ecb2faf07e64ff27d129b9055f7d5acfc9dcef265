I"àB<h2 id="1-í”„ë¡¤ë¡œê·¸">1. í”„ë¡¤ë¡œê·¸</h2>
<p>Django DRFì˜ ê½ƒ(?)ì¸ ì‹œë¦¬ì–¼ë¼ì´ì €ì— ëŒ€í•´ ì—°êµ¬í•´ë³¸ í”ì ì„ ë‚¨ê²¨ë³´ë ¤ í•œë‹¤.
<br /><br /></p>

<h2 id="2-serializer">2. Serializer</h2>
<h3 id="ì‹œë‚˜ë¦¬ì˜¤-1">ì‹œë‚˜ë¦¬ì˜¤ 1</h3>
<p>flowers/<int:pk>ì˜ 'GET ì ‘ê·¼í–ˆì„ë•Œ ê½ƒì— ëŒ€í•œ ìì„¸í•œ ì •ë³´ë¥¼ ë°˜í™˜í•˜ëŠ” ì‹œë¦¬ì–¼ë¼ì´ì €ë¥¼ êµ¬í˜„í•˜ê³ ì í•œë‹¤.</int:pk></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">FlowerDetailSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">Serializer</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">()</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">()</span>
    <span class="n">season</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>
    <span class="n">star</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">FloatField</span><span class="p">()</span>
    <span class="n">purposes</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">PrimaryKeyRelatedField</span><span class="p">(</span><span class="n">many</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">languages</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">PrimaryKeyRelatedField</span><span class="p">(</span><span class="n">many</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">PrimaryKeyRelatedField</span><span class="p">(</span><span class="n">many</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">images</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">PrimaryKeyRelatedField</span><span class="p">(</span><span class="n">many</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>
<p><img src="/img/2019/08/25/serializer/simple.png" alt="Image Alt í…ìŠ¤íŠ¸" /></p>

<p>ì´ë ‡ê²Œ í•˜ë©´ purposes, languages. colors, imagesì˜ ë‹¤ëŒ€ë‹¤ ê´€ê³„ë¥¼ ê°€ì§„ í•„ë“œë“¤ì´
serializers.PrimaryKeyRelatedField() ë¥¼ í†µê³¼í•˜ë©´ì„œ ê¸°ë³¸í‚¤ë¡œ ë°”ë€Œì–´ì„œ ë°˜í™˜ëœë‹¤.</p>

<p>ë‹¤ëŒ€ë‹¤ëª¨ë¸ì€ ì—¬ëŸ¬ê°œì˜ ê°’ì´ ì¡´ì¬í• ìˆ˜ ìˆìœ¼ë¯€ë¡œ many=Trueë¡œ ì„¤ì •í•˜ì—¬ì•¼ í•˜ë©°, ì¼ë‹¨ ê½ƒì— ëŒ€í•œ ë°ì´í„°ë¥¼ ì½ì–´ë“¤ì—¬ì•¼ í•˜ê¸°ë•Œë¬¸ì—
read_only=Trueë¡œ ì„¤ì •í•˜ì˜€ë‹¤. ë‹¤ëŒ€ë‹¤ëª¨ë¸ì„ create, updateí• ë•ŒëŠ” ë‹¤ìŒì— ê³µë¶€í•´ì„œ ë‹¤ë£¨ì–´ë³´ê² ë‹¤.</p>

<p>í•˜ì§€ë§Œ ê½ƒì˜ ë°ì´í„°ë¿ë§Œì•„ë‹ˆë¼ purposes, languages. colors, imagesì— ëŒ€í•œ ìì„¸í•œ ì •ë³´ê°€ í•„ìš”í•˜ê¸°ë•Œë¬¸ì— 
ì½”ë“œë¥¼ ì•„ë˜ì™€ ê°™ì´ ê³ ì³ì„œ ì¨ë³´ì</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">FlowerDetailSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">Serializer</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">()</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">()</span>
    <span class="n">season</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>
    <span class="n">star</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">FloatField</span><span class="p">()</span>
    <span class="n">purposes</span> <span class="o">=</span> <span class="n">PurposeSerializer</span><span class="p">(</span><span class="n">many</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">languages</span> <span class="o">=</span> <span class="n">LanguageSerializer</span><span class="p">(</span><span class="n">many</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">ColorSerializer</span><span class="p">(</span><span class="n">many</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">images</span> <span class="o">=</span> <span class="n">ImageSerializer</span><span class="p">(</span><span class="n">many</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">ImageSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Image</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s">'url'</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">ColorSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Color</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="s">'__all__'</span>


<span class="k">class</span> <span class="nc">LanguageSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Language</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="s">'__all__'</span>


<span class="k">class</span> <span class="nc">PurposeSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Purpose</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s">'name'</span><span class="p">,</span> <span class="s">'image'</span><span class="p">]</span>
</code></pre></div></div>
<p><img src="/img/2019/08/25/serializer/detail.png" alt="Image Alt í…ìŠ¤íŠ¸" /></p>

<p>ì´ëŸ¬í•œ ë°©ì‹ì„ nested serializerë¼ê³  í•œë‹¤. ëŒ€ëŒ€ë‹¤ ëª¨ë¸ì˜ ê°’ë“¤ì´ ê°ê°ì˜ ì‹œë¦¬ì–¼ë¼ì´ì €ë¥¼ í†µê³¼í•˜ë©´ì„œ
purposes, languages. colors, imagesì— ëŒ€í•œ ìì„¸í•œ ì •ë³´ë¥¼ ì¶œë ¥í• ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤.
ë‹¤ëŒ€ë‹¤ ëª¨ë¸ì€ ê°’ì´ ì—¬ëŸ¬ê°œê°€ ë ìˆ˜ ìˆê¸° ë•Œë¬¸ì— many=Trueë¡œ ì„¤ì •í•´ì£¼ì
<br /><br /></p>

<h3 id="ì‹œë‚˜ë¦¬ì˜¤-2">ì‹œë‚˜ë¦¬ì˜¤ 2</h3>
<p>flowers/flower_pk/commentsì— â€˜GETâ€™ ìœ¼ë¡œ ì ‘ê·¼í–ˆì„ë•Œ ì ‘ì†í•œ ìœ ì €ê°€ ëŒ“ê¸€ì— ì¢‹ì•„ìš”ë¥¼ í–ˆëŠ”ì§€ì˜ ì—¬ë¶€, ì´ ëŒ“ê¸€ì˜ ì†Œìœ ìì¸ì§€ì˜ ì—¬ë¶€ë¥¼ ë³´í•¨í•œ
ëŒ“ê¸€ì˜ ì •ë³´ë¥¼ ë°˜í™˜í•˜ê²Œ í•œë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">CommentSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">Serializer</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">()</span>
    <span class="n">star</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">()</span>
    <span class="n">created_at</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">()</span>

    <span class="n">is_like</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">SerializerMethodField</span><span class="p">(</span><span class="s">'get_is_like'</span><span class="p">)</span>
    <span class="n">is_owner</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">SerializerMethodField</span><span class="p">(</span><span class="s">'get_is_owner'</span><span class="p">)</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">UserNicknameSerializer</span><span class="p">(</span><span class="n">read_only</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">flower</span> <span class="o">=</span> <span class="n">CommentFlowerSerializer</span><span class="p">(</span><span class="n">read_only</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_is_like</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s">'request'</span><span class="p">]</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">:</span>
            
            <span class="n">like_comment</span> <span class="o">=</span> <span class="n">CommentLike</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span>
                <span class="n">comment</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s">'request'</span><span class="p">]</span><span class="o">.</span><span class="n">user</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">like_comment</span><span class="p">:</span>    
                <span class="k">return</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="bp">False</span>
    
    <span class="k">def</span> <span class="nf">get_is_owner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">user</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s">'request'</span><span class="p">]</span><span class="o">.</span><span class="n">user</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

</code></pre></div></div>

<ul>
  <li>serializers.SerializerMethodFieldë¥¼ ì´ìš©í•˜ë©´ ì‚¬ìš©ìê°€ ì •ì˜í•œ ë©”ì†Œë“œì˜ ë°˜í™˜ê°’ì„ serializer.dataì— ì¶”ê°€í• ìˆ˜ ìˆë‹¤.
serializers.SerializerMethodField()ì˜ ì¸ìë¡  ì‚¬ìš©ìê°€ ì •ì˜í•œ í•¨ìˆ˜ì˜ ì´ë¦„ì´ ë“¤ì–´ê°„ë‹¤. 
ì‚¬ìš©ì ì •ì˜ í•¨ìˆ˜ëŠ” serializerì— ëŒ€í•œ ì°¸ì¡° self, model ê°ì²´ì— ëŒ€í•œ ì°¸ì¡° objê°€ ë“¤ì–´ê°„ë‹¤. selfë¥¼ í†µí•´ serializerì˜ contextì—
ì ‘ê·¼í• ìˆ˜ ìˆê³  objì„ í†µí•´ ëª¨ë¸ì˜ ë°ì´í„°ì— ì ‘ê·¼í• ìˆ˜ ìˆë‹¤.
<br /><br /></li>
</ul>

<h3 id="ì‹œë‚˜ë¦¬ì˜¤-3">ì‹œë‚˜ë¦¬ì˜¤ 3</h3>
<p>flowers/flower_pk/commentsì— â€˜POSTâ€™ â€˜PUTâ€™ ìœ¼ë¡œ ì ‘ê·¼í–ˆì„ë•Œ ëŒ“ê¸€ì„ create, update í•œë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">CommentCreateSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">Serializer</span><span class="p">):</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">allow_blank</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">star</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">FloatField</span><span class="p">(</span><span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">MinValueValidator</span><span class="p">(</span><span class="mf">0.0</span><span class="p">),</span> <span class="n">MaxValueValidator</span><span class="p">(</span><span class="mf">5.0</span><span class="p">)],</span> <span class="n">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">validated_data</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Comment</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">validated_data</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">validated_data</span><span class="p">):</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">validated_data</span><span class="p">[</span><span class="s">'content'</span><span class="p">]</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="s">'star'</span><span class="p">,</span> <span class="n">validated_data</span><span class="p">[</span><span class="s">'star'</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">instance</span>
</code></pre></div></div>
<ul>
  <li>serializers.Serializerì˜ ê²½ìš° ì—ëŠ” create, updateë¥¼ í•˜ê¸°ìœ„í•´ì„  create(), update()ë¥¼ ìœ„ì™€ ê°™ì´ ì¬ì •ì˜
í•´ì£¼ì–´ì•¼ë§Œ í•œë‹¤. ì´ë²ˆì— ìƒˆë¡­ê²Œ ì•Œì•˜ëŠ”ë° setattr()ì„ í†µí•´ ë”•ì…”ë„ˆë¦¬ íƒ€ì…ì˜ ê°’ì„ ì„¤ì •í•˜ëŠ”ê²Œ ê°€ëŠ¥í•˜ë‹¤.</li>
</ul>
:ET