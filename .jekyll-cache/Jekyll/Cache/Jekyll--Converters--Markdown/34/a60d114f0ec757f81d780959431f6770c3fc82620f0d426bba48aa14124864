I"‘d<h2 id="1-d-o-c-k-e-r">1. D O C K E R</h2>
<p><img src="/img/2019/08/27/Docker-scenario/New_Docker_logo_Logo.jpg" alt="Image Alt í…ìŠ¤íŠ¸" />
ë„ì»¤ëŠ” ì‚¬ìš©ìê°€ ì›í•˜ëŠ” ì‘ìš© í”„ë¡œê·¸ë¨ë“¤ì„ ì»¨í…Œì´ë„ˆ(í”„ë¡œì„¸ìŠ¤) ì•ˆì— ê²©ë¦¬ì‹œì¼œ í™œìš©í• ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ì˜¤í”ˆì†ŒìŠ¤ í”„ë¡œì íŠ¸ì´ë‹¤.
ë§Œì•½ ì—¬ëŸ¬ë¶„ì´ ë£¨ë¹„ê°œë°œì„ í•œë‹¤ê³  ê°€ì •í•´ë³´ì. ê¸°ì¡´ ë°©ì‹ì´ë¼ë©´ ë¡œì»¬í™˜ê²½ì— ë£¨ë¹„ë¥¼ ê¹”ê³  ê°œë°œì„ ì‹œì‘í–ˆê² ì§€ë§Œ, Dockerë¥¼ í™œìš©í•˜ê²Œ ë˜ë©´
ë£¨ë¹„ ê°œë°œí™˜ê²½ì„ ê°€ì§€ê³  ìˆëŠ” ì´ë¯¸ì§€ë¡œ ë¶€í„° ì»¨í…Œì´ë„ˆë¥¼ ìƒì„±í•˜ì—¬ ì ‘ì†í•˜ê³ , ë£¨ë¹„ê°œë°œì€ ì»¨í…Œì´ë„ˆì˜ í™˜ê²½ë§Œì„ ì´ìš©í•˜ì—¬ ì§„í–‰í•˜ê²Œ ë˜ëŠ”ê²ƒì´ë‹¤.<br /></p>

<h2 id="2-ì™œ-ë„ì»¤ë¥¼-ì“°ëŠ”ê°€">2. ì™œ ë„ì»¤ë¥¼ ì“°ëŠ”ê°€?</h2>
<p>ê¸°ì¡´ì˜ ê°€ìƒë¨¸ì‹  (vmware)ì€ OSìì²´ë¥¼ ê°€ìƒí™”í•˜ëŠ” ë°©ì‹ì„ ì‚¬ìš©í•˜ê³  ìˆì—ˆë‹¤. ì´ë°©ì‹ì€ ê°„ë‹¨í•˜ì§€ë§Œ ë¬´ê²ê³  ëŠë ¤ì„œ ìš´ì˜í™˜ê²½ì—ì„œ ì‚¬ìš©í•˜ê¸°
ì—ëŠ” ë¬´ë¦¬ê°€ ìˆë‹¤. ë°˜ë©´ DockerëŠ” í”„ë¡œì„¸ìŠ¤(ì»¨í…Œì´ë„ˆ)ì˜ í˜•íƒœë¡œ ê²©ë¦¬ì‹œí‚¤ëŠ” ë°©ë²•ì„ ì„ íƒí–ˆê³ , ì—¬ëŸ¬ ì»¨í…Œì´ë„ˆë“¤ì€ Dockerê°€ ì œê³µí•˜ëŠ” Layerë¥¼ í†µí•´
í•˜ë‚˜ì˜ OSìœ„ì—ì„œ ë™ì‘í• ìˆ˜ ìˆê²Œ ë§Œë“¤ì–´ì£¼ì—ˆë‹¤. ì´ë¥¼ í†µí•´ DockerëŠ” í˜¸ìŠ¤íŠ¸ ê¸°ì¤€ 95% ì´ìƒì˜ ì„±ëŠ¥ì„ ë‚¼ìˆ˜ ìˆëŠ” ì¥ì ì„ ê°€ì§€ê³  ìˆë‹¤.<br /></p>

<p>ë„ì»¤ëŠ” íŠ¹ì •ì„œë¹„ìŠ¤ë¥¼ ì—¬ëŸ¬ê°œ ëŒë¦´ìˆ˜ ìˆëŠ” ì¥ì ì„ ê°€ì§€ê³  ìˆë‹¤. ê¸°ì¡´ì˜ ë¡œì»¬í™˜ê²½ì—ì„œëŠ” nginxë¥¼ í•˜ë‚˜ë§Œ ê¹”ìˆ˜ ìˆì§€ë§Œ, Dockerë¥¼ í™œìš©í•˜ë©´ 
nginxê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” ì»¨í…Œì´ë„ˆë¥¼ nê°œ ìƒì„±í• ìˆ˜ ìˆë‹¤. ì´ëŸ¬í•œ ì ì„ ì´ìš©í•˜ì—¬ ë¡œë“œë°¸ëŸ°ì„œë¥¼ êµ¬í˜„í•œë‹¤ë˜ì§€, ë¬´ì¤‘ë‹¨ ë°°í¬ë¥¼ í•´ë³¸ë‹¤ë˜ì§€ ì¬ë¯¸ìˆëŠ”ì¼ì„
ë§ì´ ì‹œë„í• ìˆ˜ ìˆë‹¤. <br /></p>

<p>ì—¬ëŸ¬ë¶„ì´ ìë°”ì–¸ì–´ë¥¼ ê³µë¶€í•˜ê³  ê³¼ì œë¥¼ í•œí›„ jdkë¥¼ ì´ìš©í•˜ì—¬ binary íŒŒì¼ì„ ë½‘ì•„ëƒˆë‹¤ê³  ê°€ì •í•´ë³´ì. ì´ ë°”ì´ë„ˆë¦¬ íŒŒì¼ì€ JVMì´ ì„¤ì¹˜ë˜ì–´ìˆëŠ” ì–´ë–¤ í™˜ê²½ì—ì„œë„ ë˜‘ê°™ì€ ë™ì‘ì„ ë³´ì¥í•´ì¤€ë‹¤. ë§ˆì°¬ê°€ì§€ë¡œ ë„ì»¤ë¥¼ í™œìš©í•˜ì—¬ ë¹Œë“œëœ ì´ë¯¸ì§€ê°€ ìˆë‹¤ê³  ê°€ì •í–ˆì„ë•Œ, ì´ë¯¸ì§€ë¥¼ ì´ìš©í•˜ì—¬ ë§Œë“¤ì–´ì§„ ì»¨í…Œì´ë„ˆëŠ” ë„ì»¤ê°€ ì„¤ì¹˜ëœ ì–´ë–¤ í™˜ê²½ì—ì„œ ë˜‘ê°™ì€ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•´ì£¼ëŠ” ì¥ì ì´ ìˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ íŒŒì´ì¬ ê°œë°œì„ ìœ„í•´ì„œ ì´ë¯¸ì§€ë¥¼ ë§Œë“¤ì–´ ë†“ì•˜ëŠ”ë°, ë‚˜ì¤‘ì— íŒŒì´ì¬ ê°œë°œì´ í•„ìš”í•œ ì‹œì ì´ ì™”ì„ë•Œ ê·¸ ì´ë¯¸ì§€ë¥¼ ê·¸ëŒ€ë¡œ í™œìš©í•˜ì—¬ ì»¨í…Œì´ë„ˆë¥¼ ìƒì„±í•˜ì—¬ ê°œë°œí•˜ë©´ ë˜ëŠ”ê²ƒì´ë‹¤. ì¦‰ í™˜ê²½ êµ¬ì¶•ì— íŒ”ìš”í•œ ì‹œê°„ì„ ì¤„ì¼ìˆ˜ ìˆì–´ DEVOPS ì˜ ì§€í–¥ì ê³¼ ì¼ì¹˜í•˜ëŠ”ê²ƒì´ë‹¤.<br /></p>

<h2 id="3-ë„ì»¤ë¡œ-ê°œë°œí™˜ê²½-êµ¬ì¶•í•˜ê¸°">3. ë„ì»¤ë¡œ ê°œë°œí™˜ê²½ êµ¬ì¶•í•˜ê¸°</h2>
<p>ë‚˜ëŠ” â€˜ë„ì»¤ë¥¼ í™œìš©í•˜ì—¬ ë§Œë“¤ì–´ì§„ ì»¨í…Œì´ë„ˆì˜ í™˜ê²½ë§Œì„ ì´ìš©í•˜ì—¬ ë£¨ë¹„ ê°œë°œì„ ì§„í–‰í•œë‹¤â€™ ë¼ëŠ” ì•¼ì‹¬ì°¬ ê³„íšì„ì„¸ìš°ê³  ì§„í–‰í–ˆë˜ ê²°ê³¼ë¬¼ì„ ê³µìœ í•´ë³´ë ¤ í•œë‹¤.
ê°€ì •ë¨¼ì € í•´ì•¼í•˜ëŠ”ì¼ì€ dockerì™€ docker-composeë¥¼ ì„¤ì¹˜í•˜ëŠ”ì¼ì´ì—ˆë‹¤.
ì°¸ê³ ìë£Œ: https://myjamong.tistory.com/105</p>

<h3 id="1-ë£¨ë¹„-base-ì´ë¯¸ì§€-ë§Œë“¤ê¸°">1. ë£¨ë¹„ Base ì´ë¯¸ì§€ ë§Œë“¤ê¸°</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FROM amazonlinux

ENV RUBY_VERSION 2.6.3
ENV RUBY_INSTALL_PACKAGE 0.7.0

<span class="c"># update os</span>
RUN yum update <span class="nt">-y</span> <span class="o">&amp;&amp;</span> yum clean all
RUN yum <span class="nb">install</span> <span class="nt">-y</span> which <span class="nb">tar gzip </span>procps <span class="se">\</span>
    patch libyaml-devel libffi-devel glibc-headers autoconf <span class="se">\</span>
    gcc-c++ glibc-devel readline-devel zlib-devel openssl-devel <span class="se">\</span>
    bzip2 automake libtool bison <span class="se">\</span>
    wget git mysql-devel make libcurl-devel <span class="o">&amp;&amp;</span> yum clean all

<span class="c">#ruby install</span>
WORKDIR /ruby-install
RUN wget <span class="nt">-O</span> ruby-install-<span class="k">${</span><span class="nv">RUBY_INSTALL_PACKAGE</span><span class="k">}</span>.tar.gz https://github.com/postmodern/ruby-install/archive/v<span class="k">${</span><span class="nv">RUBY_INSTALL_PACKAGE</span><span class="k">}</span>.tar.gz <span class="se">\</span>
    <span class="o">&amp;&amp;</span> <span class="nb">tar</span> <span class="nt">-xzvf</span> ruby-install-<span class="k">${</span><span class="nv">RUBY_INSTALL_PACKAGE</span><span class="k">}</span>.tar.gz
WORKDIR /ruby-install/ruby-install-<span class="k">${</span><span class="nv">RUBY_INSTALL_PACKAGE</span><span class="k">}</span>/
RUN make <span class="nb">install</span> <span class="o">&amp;&amp;</span> ruby-install <span class="nt">--system</span> ruby <span class="k">${</span><span class="nv">RUBY_VERSION</span><span class="k">}</span> <span class="o">&amp;&amp;</span> <span class="nb">rm</span> <span class="nt">-rf</span> /ruby-install

<span class="c">#bundler install</span>
RUN gem <span class="nb">install </span>bundler <span class="o">&amp;&amp;</span> <span class="nb">rm</span> <span class="nt">-rf</span> /tmp/<span class="k">*</span> /var/tmp/<span class="k">*</span> /usr/lib/ruby/gems/<span class="k">*</span>/cache/<span class="k">*</span>.gem
WORKDIR /
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker build <span class="nt">-t</span> lunacircle4/ruby:2.6.3 <span class="nb">.</span>
</code></pre></div></div>
<p>FROM ëª…ë ¹ì–´ë¥¼ ì´ìš©í•˜ì—¬ baseê°€ ë˜ëŠ” ì´ë¯¸ì§€ë¥¼ ì„¤ì •í• ìˆ˜ ìˆë‹¤. (ë‚˜ëŠ” ì•„ë§ˆì¡´ ë¦¬ëˆ…ìŠ¤ë¥¼ ì¢‹ì•„í•œë‹¤.)
Dockerfileì„ ì‘ì„±í• ë•Œ RUN ëª…ë ¹ì–´ë¥¼ í™œìš©í•˜ì—¬ ì»¨í…Œì´ë„ˆ í™˜ê²½ì— í•„ìš”í•œ ìš”ì†Œë“¤ì„ êµ¬ì¶•í• ìˆ˜ ìˆë‹¤.
ì´ë•Œ ì£¼ì˜í• ì ì€ RUN ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰ì‹œ ì„ì‹œíŒŒì¼ì´ ìƒê¸¸ ê°€ëŠ¥ì„±ì´ ìˆìœ¼ë©´ &amp;&amp; ë¥¼ í™œìš©í•˜ì—¬ ë°”ë¡œ ì§€ì›Œì¤˜ì•¼í•œë‹¤.
ì§€ì›Œì§€ì§€ ì•Šìœ¼ë©´ ê·¸ëŒ€ë¡œ layerë¡œ ë‚¨ê²Œë˜ì–´ ë¹Œë“œí›„ ì´ë¯¸ì§€ì˜ ìš©ëŸ‰ì´ ì»¤ì§€ê²Œ ëœë‹¤. ë‚˜ëŠ” ì´ëŸ° ê¸°ë²•ì„ í™œìš©í•˜ì—¬ 
ìµœì¢…ì´ë¯¸ì§€ ìš©ëŸ‰ì„ 1GB ì¤„ì¼ìˆ˜ ìˆì—ˆë‹¤.</p>

<h3 id="2-rails-base-ì´ë¯¸ì§€-ë§Œë“¤ê¸°">2. rails Base ì´ë¯¸ì§€ ë§Œë“¤ê¸°</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ë£¨ë¹„ ë² ì´ìŠ¤ ì´ë¯¸ì§€</span>
FROM gomicorp/ruby:2.6.3

ENV RAILS_VERSION 6.0.2.1

<span class="c"># install node:10</span>
RUN curl <span class="nt">-sL</span> https://rpm.nodesource.com/setup_10.x | bash -
RUN yum <span class="nb">install</span> <span class="nt">-y</span> nodejs <span class="o">&amp;&amp;</span> yum clean all

<span class="c"># yarn install</span>
RUN curl <span class="nt">--silent</span> <span class="nt">--location</span> https://dl.yarnpkg.com/rpm/yarn.repo | <span class="nb">tee</span> /etc/yum.repos.d/yarn.repo
RUN yum <span class="nb">install</span> <span class="nt">-y</span> yarn <span class="o">&amp;&amp;</span> yum clean all

<span class="c">#rails install</span>
RUN gem <span class="nb">install </span>rails <span class="nt">-v</span> <span class="k">${</span><span class="nv">RAILS_VERSION</span><span class="k">}</span> <span class="o">&amp;&amp;</span> <span class="nb">rm</span> <span class="nt">-rf</span> /tmp/<span class="k">*</span> /var/tmp/<span class="k">*</span> /usr/lib/ruby/gems/<span class="k">*</span>/cache/<span class="k">*</span>.gem
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker build <span class="nt">-t</span> lunacircle4/rails:6.0.2.1 <span class="nb">.</span>
</code></pre></div></div>
<p>base ì´ë¯¸ì§€ëŠ” ì•„ê¹Œ ë§¨ë“  ë£¨ë¹„ ì´ë¯¸ì§€ë¥¼ í™œìš©í–ˆë‹¤. rails ê°œë°œì— í•„ìš”í•œ nodejs, yarn, rails gemì„ ì„¤ì¹˜í•˜ëŠ” ê³¼ì •ì„ ê¸°ìˆ í•˜ì˜€ë‹¤.</p>

<h3 id="3-ì§„ì§œ-ê°œë°œí™˜ê²½-ì´ë¯¸ì§€-ë§Œë“¤ê¸°">3. ì§„ì§œ ê°œë°œí™˜ê²½ ì´ë¯¸ì§€ ë§Œë“¤ê¸°</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ë£¨ë¹„ ë² ì´ìŠ¤ ì´ë¯¸ì§€</span>
FROM gomicorp/rails:6.0.2.1
WORKDIR /app

<span class="c">#gem ì„¤ì¹˜</span>
COPY Gemfile ./
RUN bundle <span class="nb">install</span> <span class="o">&amp;&amp;</span> <span class="nb">rm</span> <span class="nt">-rf</span> /tmp/<span class="k">*</span> /var/tmp/<span class="k">*</span> /usr/lib/ruby/gems/<span class="k">*</span>/cache/<span class="k">*</span>.gem
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker build <span class="nt">-t</span> my_project_image <span class="nb">.</span>
</code></pre></div></div>
<p>ì‚¬ì‹¤ ìœ„ì—ì„œ ë§Œë“  lunacircle4/rails:6.0.2.1ë¥¼ ê°€ì§€ê³  ë°”ë¡œ ê°œë°œì„ ì§„í–‰í•´ë„ ìƒê´€ì´ ì—†ë‹¤.
í•˜ì§€ë§Œ ì—¬ëŸ¬ ê°œë°œí”„ë¡œì íŠ¸ê°€ í•œë²ˆì— ëŒì•„ê°ˆìˆ˜ ìˆìœ¼ë¯€ë¡œ ìœ„ì˜ ì´ë¯¸ì§€ë¥¼ ë°”íƒ•ìœ¼ë¡œ ê°ê°ì˜ ì´ë¯¸ì§€ë¥¼ ë§Œë“¤ì–´ 
ê´€ë¦¬í•˜ëŠ”ê²ƒì´ ì¢‹ë‹¤ê³  íŒë‹¨í•˜ì—¬ í•œ depthë¥¼ ë”ë“¤ì–´ê°€ê¸°ë¡œ íŒë‹¨í–ˆë‹¤. (ë§ˆì¹˜ ê°€ìƒí™˜ê²½ì´ë„ê¹Œ)
ê°ê°ì— ê°œë°œí™˜ê²½ì— í•„ìš”í•œ Gemfileì„ ì´ìš©í•˜ì—¬ gemë“¤ì´ installëœ ìµœì¢… ê°œë°œì´ë¯¸ì§€ë¥¼ ë§Œë“¤ì—ˆë‹¤.<br /></p>

<h3 id="4-ì´ë¯¸ì§€ë¡œ-ë¶€í„°-ì»¨í…Œì´ë„ˆë¥¼-ë§Œë“œëŠ”-ì‘ì—…ì„-ê°„í¸í•˜ê²Œ-í•´ë³´ì">4. ì´ë¯¸ì§€ë¡œ ë¶€í„° ì»¨í…Œì´ë„ˆë¥¼ ë§Œë“œëŠ” ì‘ì—…ì„ ê°„í¸í•˜ê²Œ í•´ë³´ì</h3>
<p>ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ë©´ ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•˜ì—¬ ê°œë°œì„ ì§„í–‰í• ìˆ˜ ìˆë‹¤.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">--rm</span> <span class="nt">-it</span> <span class="nt">--env-file</span> <span class="si">$(</span><span class="nb">pwd</span><span class="si">)</span>/.env <span class="nt">-p</span> 3030:3030 <span class="nt">-v</span> <span class="si">$(</span><span class="nb">pwd</span><span class="si">)</span>:/app <span class="se">\</span>
my_project_image bash <span class="nt">-c</span> <span class="s1">'rails s -b 0.0.0.0 -p 3030'</span>
</code></pre></div></div>
<p>í•˜ì§€ë§Œ ë§¤ë²ˆ ì…ë ¥í•˜ë©´ ì†ì´ ì•„í”„ë‹¤ëŠ” ë‹¨ì ì„ ê°€ì§€ê³  ìˆë‹¤. docker-composeë¼ëŠ” íˆ´ì„ í™œìš©í•˜ë©´
íŒŒì¼ë¡œ í•œë²ˆ ë§Œë“¤ì–´ì„œ ê³„ì† ì‰½ê²Œ í™œìš©í• ìˆ˜ ìˆë‹¤. â€˜start.ymlâ€™ ì´ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ í”„ë¡œì íŠ¸ ë£¨íŠ¸í´ë”ì—
ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±í•´ë³´ì•˜ë‹¤.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>version: <span class="s1">'3.1'</span>

services:
  web:
    image: my_project_image
    env_file:
      - .env
    ports:
      - <span class="s2">"3030:3030"</span>
    volumes:
      - ./:/app
    <span class="nb">command</span>:
      - /bin/bash
      - <span class="nt">-c</span>
      - |
        rails s <span class="nt">-b</span> 0.0.0.0 <span class="nt">-p</span> 3030
</code></pre></div></div>
<p>ì´ì œ ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì¹˜ë©´ ê°œë°œì„ ì‰½ê²Œ ì§„í–‰í• ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker-compose <span class="nt">-f</span> start.yml up
</code></pre></div></div>

<h3 id="5-ì‹ ë‚˜ëŠ”-ê°œë°œì„-í•˜ê³ -ì‹¶ì—ˆë‹¤">5. ì‹ ë‚˜ëŠ” ê°œë°œì„ í•˜ê³  ì‹¶ì—ˆë‹¤.</h3>
<p>ê°œë°œì— í•„ìš”í•œ ëª…ë ¹ì–´ë“¤ì„ ì•„ë˜ì™€ ê°™ì´ ì •ë¦¬í•´ë³´ì•˜ë‹¤.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Gemfile.lockì„ ë¡œì»¬ì— ë§Œë“¤ì–´ì£¼ê¸° ìœ„í•´ì„œ ì‹¤í–‰</span>
docker run <span class="nt">--rm</span> <span class="nt">-v</span> <span class="si">$(</span><span class="nb">pwd</span><span class="si">)</span>:/app my_project_image bash <span class="nt">-c</span> <span class="s1">'bundle install'</span>

<span class="c"># db create</span>
docker run <span class="nt">--rm</span> <span class="nt">-v</span> <span class="si">$(</span><span class="nb">pwd</span><span class="si">)</span>:/app  <span class="nt">--env-file</span> ./.env my_project_image <span class="se">\</span>
bash <span class="nt">-c</span> <span class="s1">'rails db:create'</span>

<span class="c"># db migrate</span>
docker run <span class="nt">--rm</span> <span class="nt">-v</span> <span class="si">$(</span><span class="nb">pwd</span><span class="si">)</span>:/app <span class="nt">--env-file</span> ./.env my_project_imagei <span class="se">\</span>
bash <span class="nt">-c</span> <span class="s1">'rails db:migrate'</span>

<span class="c"># node_modules install</span>
docker run <span class="nt">--rm</span> <span class="nt">-v</span> <span class="si">$(</span><span class="nb">pwd</span><span class="si">)</span>:/app my_project_image <span class="nt">-c</span> <span class="s1">'yarn install'</span>

<span class="c"># asset compile</span>
docker run <span class="nt">--rm</span> <span class="nt">-v</span> <span class="si">$(</span><span class="nb">pwd</span><span class="si">)</span>:/app my_project_image <span class="se">\</span>
bash <span class="nt">-c</span> <span class="s1">'rails assets:precompile RAILS_ENV=production'</span>

<span class="c"># ê°œë°œí™˜ê²½ ì‹œì‘</span>
docker-compose <span class="nt">-f</span> start.yml up
</code></pre></div></div>
<p>ë„ì»¤ë¥¼ 2ë‹¬ ë°°ì› ì§€ë§Œ ëª…ë ¹ì–´ì˜ ì¥ë²½ì€ ë†’ì•˜ê³ , ì²˜ìŒ ë„ì»¤ë¥¼ ì ‘í•˜ëŠ”ì‚¬ëŒë“¤ì€ í˜ë“¤ì–´í• ê²ƒ ê°™ì•„
ë‹¤ë¥¸ ë°©ë²•ì„ ìƒê°í•´ì•¼ í–ˆë‹¤. ê·¸ë¦¬ê³  ê°‘ìê¸° ë“  ìƒê°ì€ rake_taskë¥¼ ë§Œë“œëŠ”ì¼ì´ì—ˆë‹¤.</p>

<h3 id="6-rake_taskë¡œ-í•´ê²°ì´-ëœì¤„-ì•Œì•˜ë‹¤">6. rake_taskë¡œ í•´ê²°ì´ ëœì¤„ ì•Œì•˜ë‹¤.</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>task :dev_init <span class="k">do
  </span><span class="nb">exec</span><span class="o">(</span><span class="s1">'docker build -t my_project_image .'</span><span class="o">)</span>
end
    
task :asset_compile <span class="k">do
  </span><span class="nb">exec</span><span class="o">(</span><span class="s1">'docker exec my_project_image_web_1 rails assets:precompile RAILS_ENV=production'</span><span class="o">)</span>
end
    
task :dev_new_gem  <span class="k">do
  </span><span class="nb">exec</span><span class="o">(</span><span class="s1">'docker exec my_project_image_web_1 bundle install &amp;&amp; sudo rm -rf /tmp/* /var/tmp/* /usr/lib/ruby/gems/*/cache/*.gem'</span><span class="o">)</span>
  <span class="nb">exec</span><span class="o">(</span><span class="s1">'docker commit my_project_image_web_1my_project_image'</span><span class="o">)</span>
end
    
task :dev_start <span class="k">do
  </span><span class="nb">exec</span><span class="o">(</span><span class="s1">'docker-compose -f start.yml up'</span><span class="o">)</span>
end
    
task :dev_stop <span class="k">do
  </span><span class="nb">exec</span><span class="o">(</span><span class="s1">'docker-compose -f start.yml down'</span><span class="o">)</span>
end
</code></pre></div></div>
<p>ì´ì œëŠ” â€˜rails dev_initâ€™ ê°™ì€ ëª…ë ¹ì–´ë¡œ ì‰½ê²Œ ê°œë°œí• ìˆ˜ ìˆì„êº¼ë¼ëŠ” ì°©ê°ì— ë¹ ì¡Œë‹¤.
í•˜ì§€ë§Œ ì»¨í…Œì´ë„ˆ ë‚´ì˜ í™˜ê²½ë§Œì„ ì´ìš©í•˜ì—¬ ê°œë°œì„ ì§„í–‰í•˜ê² ë‹¤ëŠ” ë‚˜ì˜ ëª©í‘œì™€ ì¼ì¹˜í•˜ì§€ ì•Šì•˜ë‹¤
ì™œëƒí•˜ë©´ rake_taskë¥¼ ì“°ê²Ÿë‹¤ê³  ìƒê°í•˜ëŠ” ìˆœê°„ì— ë¡œì»¬í™˜ê²½ì— railë¥¼ ì„¤ì¹˜í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì´ë‹¤.
ë‹¤ë¥¸ ë°©ë²•ì€ ì—†ì„ê¹Œí•˜ë‹¤ ì‰˜ìŠ¤í¬ë¦½íŠ¸ë¥¼ í™œìš©í•˜ëŠ” ë°©ë²•ìœ¼ë¡œ ì „í–¥í–ˆë‹¤!</p>

<h3 id="7-shell_scriptë¡œ-ì‰½ê²Œ-ê°œë°œí• ìˆ˜-ìˆì„ì¤„-ì•Œì•˜ë‹¤">7. shell_scriptë¡œ ì‰½ê²Œ ê°œë°œí• ìˆ˜ ìˆì„ì¤„ ì•Œì•˜ë‹¤.</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function </span>dev_new_gem_func <span class="o">{</span>
	docker <span class="nb">exec </span>my_project_image_web_1 bash <span class="nt">-c</span> <span class="s1">'bundle install &amp;&amp; rm -rf /tmp/* /var/tmp/* /usr/lib/ruby/gems/*/cache/*.gem'</span>
	docker commit my_project_image_web_1 my_project_image
<span class="o">}</span>

<span class="k">function </span>asset_compile_func <span class="o">{</span>
	docker <span class="nb">exec </span>my_project_image_web_1 rails assets:precompile <span class="nv">RAILS_ENV</span><span class="o">=</span>production
<span class="o">}</span>

<span class="k">function </span>dev_start_func <span class="o">{</span>
  docker-compose <span class="nt">-f</span> start.yml up
<span class="o">}</span>

<span class="k">function </span>dev_stop_func <span class="o">{</span>
  docker-compose <span class="nt">-f</span> start.yml down
<span class="o">}</span>

<span class="nb">alias </span><span class="nv">dev_init</span><span class="o">=</span>dev_init_func
<span class="nb">alias </span><span class="nv">dev_new_gem</span><span class="o">=</span>dev_new_gem_func
<span class="nb">alias </span><span class="nv">asset_compile</span><span class="o">=</span>asset_compile_func
<span class="nb">alias </span><span class="nv">dev_start</span><span class="o">=</span>dev_start_func
<span class="nb">alias </span><span class="nv">dev_stop</span><span class="o">=</span>dev_stop_func
</code></pre></div></div>
<p>ì´ë ‡ê²Œ ë§Œë“¤ë©´ ë¡œì»¬ì— ë£¨ë¹„í™˜ê²½ì´ ì„¤ì¹˜ë˜ì–´ìˆì§€ ì•Šë”ë¼ë„ ì»¨í…Œì´ë„ˆ í™˜ê²½ë§Œì„ ì´ìš©í•˜ì—¬ ê°œë°œì„ ì‰½ê²Œ ì§„í–‰í•˜ëŠ”ê²ƒì´ ê°€ëŠ¥í–ˆë‹¤.
í•˜ì§€ë§Œ ì´ë˜í•œ ì•½ê°„ì˜ ë¬¸ì œê°€ ìˆì—ˆëŠ”ë° ë°°ë²ˆ í”„ë¡œì íŠ¸ í´ë”ì— ë“¤ì–´ê°„í›„ source ëª…ë ¹ìœ¼ë¡œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë¡œë”©í•´ì•¼ dev_init
ê°™ì€ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í• ìˆ˜ ìˆë‹¤ëŠ”ê²ƒì´ë‹¤. ì´ë¥¼ ì–´ì°Œí•˜ë‚˜ ìƒê°í•˜ë‹¤ê°€ direnvë¼ëŠ” ì‹ ë°•í•œ ë¬¼ê±´ì„ ë„ì…í•˜ê²Œ ë˜ì—ˆë‹¤.</p>

<h3 id="8-direnvë¡œ-ì‰½ê²Œ-ê°œë°œí•˜ê¸°">8. direnvë¡œ ì‰½ê²Œ ê°œë°œí•˜ê¸°</h3>
<p>direnvë¥¼ í™œìš©í•˜ë©´ í”„ë¡œì íŠ¸í´ë”ì— ì§„ì…í–ˆì„ë•Œ ìë™ìœ¼ë¡œ .envrcë¥¼ ì°¾ì•„ì„œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë¡œë”©í•´ì£¼ë¯€ë¡œ í¸í•˜ê²Œ ê°œë°œí• ìˆ˜ ìˆë‹¤.
ë§Œì•½ í”„ë¡œì íŠ¸ í´ë”ë¥¼ ë¹ ì ¸ë‚˜ì˜¤ë©´ ë‹¤ì‹œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì–¸ë¡œë”©í•´ì£¼ëŠ” í¸ë¦¬í•¨ì„ ê°€ì§€ê³  ìˆì—ˆë‹¤. ì•„ë˜ì™€ ê°™ì´ direnvë¥¼ ì„¤ì¹˜í•´ì£¼ê³ 
ë‚˜ë§Œì˜ ëª…ë ¹ì–´ ëª¨ìŒì§‘ì„ ì™„ì„±í• ìˆ˜ ìˆì—ˆë‹¤.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew <span class="nb">install </span>direnv

<span class="c"># ~/.zshrcì— ì¶”ê°€í•´ì¤ë‹ˆë‹¤</span>
<span class="nb">eval</span> <span class="s2">"</span><span class="si">$(</span>direnv hook zsh<span class="si">)</span><span class="s2">"</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># .envrc íŒŒì¼ì„ ë§Œë“¤ì–´ì„œ í”„ë¡œì íŠ¸ í´ë”ì˜ ë£¨íŠ¸ ì— ë„£ì–´ì¤ë‹ˆë‹¤</span>
<span class="k">function </span>export_alias<span class="o">()</span> <span class="o">{</span>
  <span class="nb">local </span><span class="nv">name</span><span class="o">=</span><span class="nv">$1</span>
  <span class="nb">shift
  local </span><span class="nv">alias_dir</span><span class="o">=</span><span class="nv">$PWD</span>/.direnv/aliases
  <span class="nb">local </span><span class="nv">target</span><span class="o">=</span><span class="s2">"</span><span class="nv">$alias_dir</span><span class="s2">/</span><span class="nv">$name</span><span class="s2">"</span>
  <span class="nb">mkdir</span> <span class="nt">-p</span> <span class="s2">"</span><span class="nv">$alias_dir</span><span class="s2">"</span>
  PATH_add <span class="s2">"</span><span class="nv">$alias_dir</span><span class="s2">"</span>
  <span class="nb">echo</span> <span class="s2">"#!/usr/bin/env bash -e"</span> <span class="o">&gt;</span> <span class="s2">"</span><span class="nv">$target</span><span class="s2">"</span>
  <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> <span class="s2">"</span><span class="nv">$target</span><span class="s2">"</span>
  <span class="nb">chmod</span> +x <span class="s2">"</span><span class="nv">$target</span><span class="s2">"</span>
<span class="o">}</span>

export_alias image_init <span class="s2">"docker build -t my_project_image . --no-cache </span><span class="se">\</span><span class="s2">
                        &amp;&amp; docker run --rm -v </span><span class="si">$(</span><span class="nb">pwd</span><span class="si">)</span><span class="s2">:/app my_project_image bash -c 'bundle install' </span><span class="se">\$</span><span class="s2">@"</span>

export_alias db_init  <span class="s2">"docker run --rm -v </span><span class="si">$(</span><span class="nb">pwd</span><span class="si">)</span><span class="s2">:/app  --env-file ./.env my_project_image bash -c 'rails db:create' </span><span class="se">\</span><span class="s2">
                      &amp;&amp; docker run --rm -v </span><span class="si">$(</span><span class="nb">pwd</span><span class="si">)</span><span class="s2">:/app --env-file ./.env my_project_image bash -c 'rails db:migrate' </span><span class="se">\$</span><span class="s2">@"</span>

export_alias yarn_install <span class="s2">"docker run --rm -v </span><span class="si">$(</span><span class="nb">pwd</span><span class="si">)</span><span class="s2">:/app my_project_image bash -c </span><span class="se">\</span><span class="s2">
                          'yarn install' </span><span class="se">\$</span><span class="s2">@"</span>

export_alias asset_compile <span class="s2">"docker run --rm -v </span><span class="si">$(</span><span class="nb">pwd</span><span class="si">)</span><span class="s2">:/app my_project_image bash -c 'rails assets:precompile' </span><span class="se">\$</span><span class="s2">@"</span>

export_alias dev_start <span class="s2">"docker-compose -f start.yml up </span><span class="se">\$</span><span class="s2">@"</span>

export_alias dev_stop <span class="s2">"docker-compose -f start.yml down </span><span class="se">\$</span><span class="s2">@"</span>

export_alias docker_shell <span class="s2">"docker exec -it my_project_image_web_1 /bin/bash </span><span class="se">\$</span><span class="s2">@"</span>

export_alias image_update <span class="s2">"docker commit my_project_image_web_1 platform-api </span><span class="se">\$</span><span class="s2">@"</span> 
</code></pre></div></div>

<p>.envrcë¥¼ ë§Œë“¤ê³  direnv allowë¥¼ í•´ì£¼ë©´, ì•ìœ¼ë¡œ í”„ë¡œì íŠ¸ í´ë”ì— ì§„ì…ì‹œ ìë™ìœ¼ë¡œ ìŠ¤í¬ë¦½íŠ¸ê°€ ë¡œë”©ë˜ì–´ â€˜dev_startâ€™ ê°™ì€ ëª…ë ¹ì–´ë¥¼ ì‰½ê²Œ
ì‚¬ìš©í• ìˆ˜ ìˆë‹¤.</p>

<h3 id="9-docker-syncë¡œ-ê°œë°œí™˜ê²½-ì†ë„-ë†’ì´ê¸°">9. docker-syncë¡œ ê°œë°œí™˜ê²½ ì†ë„ ë†’ì´ê¸°</h3>
<p>ì´ì œ ì‹ ë‚˜ê²Œ ê°œë°œë§Œ í•˜ëŠ”ì¼ì´ ë‚¨ì•˜ëŠ”ë° ìœˆë„ìš°ì™€ ë§¥í™˜ê²½ì—ì„œ volume ì‚¬ìš©ì‹œ 60ë°°ì •ë„ì˜ ì„±ëŠ¥ì €í•˜ í˜„ìƒì´ ìˆì–´ì„œ ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•œ
ë°©ë²•ì„ ì°¾ì•„ì•¼ë§Œ í–ˆë‹¤. ì—¬ëŸ¬ ìë£Œë¥¼ ì¡°ì‚¬í•´ë³¸ëì— docker-syncë¼ëŠ” ì„œë“œíŒŒí‹°ì•±ì„ í™œìš©í•˜ê¸°ë¡œ ê²°ì •í–ˆë‹¤.
docker-syncëŠ” rubygemì˜ ì¼ì¢…ì´ì—ˆê³ , ê²°êµ­ ë¡œì»¬í™˜ê²½ì— ë£¨ë¹„ê°€ í•„ìš”í•˜ë‹¤ëŠ” ìŠ¬í”ˆì‚¬ì‹¤ì„ ì•Œì•˜ë‹¤. ì‚¬ì‹¤ ì´ëŸ°ë¬¸ì œë•Œë¬¸ì— docker-sync ë„ì…ì„
ë§ì„¤ì˜€ìœ¼ë‚˜ ì†ë„ì €í•˜í˜„ìƒì€ ì¹˜ëª…ì ì´ì—ˆê¸°ì— ê²°êµ­ì—ëŠ” ê°•í–‰í•˜ì˜€ë‹¤.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ì´ ëª…ë ¹ì–´ë¡œ docker-syncë¥¼ ì„¤ì¹˜í•œë‹¤.</span>
gem <span class="nb">install </span>docker-sync
</code></pre></div></div>

<p>docker-syncë¥¼ ì„¤ì¹˜í•œí›„ â€˜docker-sync.ymlâ€™ ì´ë¼ëŠ” íŒŒì¼ì„ ìƒì„±í•´ì£¼ê³  ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±í•˜ì˜€ë‹¤.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>version: <span class="s2">"2"</span>
syncs:
  codes:
    notify_terminal: <span class="nb">true
    </span>src: <span class="s1">'./'</span>
    sync_excludes: <span class="o">[</span><span class="s1">'.git'</span>, <span class="s1">'.idea'</span><span class="o">]</span>
</code></pre></div></div>
<p>syncs ì•„ë˜ì— â€˜codesâ€™ ë¼ëŠ” ì´ë¦„ì„ ì ì–´ì£¼ì–´ì„œ ì•„ë˜ start.ymlì—ì„œ â€˜codesâ€™ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ë³¼ë¥¨ì„ ì‚¬ìš©í• ìˆ˜ ìˆê²Œ í•´ì£¼ì—ˆë‹¤.
ê·¸ë¦¬ê³  start.yml íŒŒì¼ì„ ì•„ë˜ì™€ ê°™ì´ ìˆ˜ì •í•´ì£¼ì—ˆë‹¤.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>version: <span class="s1">'3.1'</span>

services:
  web:
    image: my_project_image
    env_file:
      - .env
    ports:
      - <span class="s2">"3030:3030"</span>
    volumes:
      - codes:/app
    <span class="nb">command</span>:
      - /bin/bash
      - <span class="nt">-c</span>
      - |
        rails s <span class="nt">-b</span> 0.0.0.0 <span class="nt">-p</span> 3030

volumes:
  codes:
    external: <span class="nb">true</span>
</code></pre></div></div>

<p>ì´ì œ ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ê³  ê°œë°œì„ ì‹œì‘í•˜ë©´ ë¹ ë¥¸ í¼í¬ë¨¼ìŠ¤ë¥¼ ê²½í—˜í• ìˆ˜ ìˆë‹¤.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker-sync start
</code></pre></div></div>

<h3 id="10-ìœ¼ì•„ì•„ì•…">10. ìœ¼ì•„ì•„ì•…</h3>
<p>ë‚˜ì˜ ëª©í‘œëŠ” ì»¨í…Œì´ë„ˆ í™˜ê²½ë§Œì„ ì´ìš©í•˜ì—¬ ë ˆì¼ì¦ˆ ê°œë°œì„ ì§„í–‰í•˜ëŠ”ê²ƒì´ì—ˆë‹¤. ë¹„ë¡ docker-syncë•Œë¬¸ì— ì™„ë²½í•˜ê²Œ ì§€í‚¤ì§€ëŠ” ëª»í–ˆì§€ë§Œ
ì–´ëŠì •ë„ ë¡œì»¬í™˜ê²½ê³¼ ê²©ë¦¬ë˜ì–´ ê°œë°œì„ ì§„í–‰í• ìˆ˜ ìˆì—ˆë‹¤. ë„ì»¤ë¥¼ ê°œë°œì„ ì‹œì‘í•˜ë©´ì„œ ê´€ë¦¬í•´ì•¼í•  íŒŒì¼ë“¤ì´ ëŠ˜ì–´ë‚¬ê³ , 
ë„ì»¤ë¡œ ì—¬ëŸ¬ê°œì˜ ì»¨í…Œì´ë„ˆë¡œ ëŒë¦´ë•Œ docker-compose ë§Œìœ¼ë¡œ ì»¤ë²„í•˜ê¸° í˜ë“  ìƒí™©ì´ ë°œìƒí• ê²ƒ ê°™ì•„ ìˆ˜ë§ì€ ê³ ë¯¼ì´ ë“¤ì—ˆë‹¤.
ì´ëŸ¬í•œ ë¬¸ì œë“¤ ë•Œë¬¸ì— ì»¨í…Œì´ë„ˆ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ì´ ê°œë…ì´ ë‚˜ì˜¨ê²ƒ ê°™ê³  ì¿ ë²„ë„¤í‹°ìŠ¤ë¥¼ ê³µë¶€í•´ì•¼ê² ë‹¤ëŠ” ìƒê°ì„ í•˜ë©° ê¸€ì„ ë§ˆì³ë³´ë ¤ í•œë‹¤.</p>

<h3 id="11-ì°¸ê³ ìë£Œ">11. ì°¸ê³ ìë£Œ</h3>
<p>https://subicura.com/2017/01/19/docker-guide-for-beginners-1.html<br />
https://medium.com/myrealtrip-product/docker-%EB%A1%9C-%EC%BE%8C%EC%A0%81%ED%95%9C-%EA%B0%9C%EB%B0%9C%ED%99%98%EA%B2%BD-%EA%B5%AC%EC%B6%95%ED%95%98%EA%B8%B0-e484b80947a3</p>
:ET