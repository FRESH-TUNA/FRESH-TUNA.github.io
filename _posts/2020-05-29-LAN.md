---
layout: post
title: "ARP"
author: "DONGWON KIM"
meta: "Springfield"
categories: "network"
comments: true
---

## 1. LAN
L2 switch는 3계층의 RIP, OSPF 등의 라우팅 알고리즘을 사용하지 않는다. 오로지 MAC주소만을 사용하여 스위치가 구성한 네트워크안에서 페킷을 주고 받는다. 

## 2. MAC 주소
엄밀히 말하면 호스트나 라우터가 mac주소를 가지고 있는것이 아니라 호스트나 라우터의 네트워크 인터페이스 (NIC)가 고유한 MAC주소를 가지고 있다. 이를 생각해보면 호스트가 여러개의 NIC를 가지고 있다면 여러개의 MAC주소를 가지는것이 가능하다. 스위치는 맥주소를 가지고 있지 않고 노드간 패킷교환만 담당한다. IP주소가 자신이 연결되어있는 네트워크가 바뀌면 변동의 가능성이 있지만 맥주소는 임의로 변경하지 않는이상 불변하다. 스위치는 종종 모든 포트로 수신한 패킷을 브로드캐스팅 하는데, 목적지주소와 자신의 주소가 일치하는 유일한 노드만이 패킷을 처리한다. 만약 목적지 주소가 FF-FF-FF-FF-FF-FF인 패킷이 스위치에 도착하면 모든 포트로 브로드케스트 한다. 

### 3. ARP
송신지와 수신지가 같은 서브넷에 속해있다면 수신지의 IP주소와 MAC주소가 모두 필요하다. 이를 위해 송신지에서 arp 모듈에 수신지의 ip주소를 넘겨주면 수신지의 mac 주소를 반환한다. DNS와 동작원리가 매우 유사하나 DNS는 인터넷에 연결되어있는 어디에서나 사용할수 있다는점에서 차이가 있다. 각각의 호스트와 라우터는 메모리에 ARP table을 관리한다. ARP 요청 패킷을 브로드캐스트 하면, 받은 노드들중 자신의 ip주소와 일치하는 유일한 노드만이 자신의 mac주소를 반환하게 된다. 만약 송신자와 수신자가 다른 서브넷에 속해있다면 어떻게 해야할까? 이때 수신자의 ip를 가지고 arp를 시도하면 같은 서브넷이 아니므로 실패한다. 이때는 datagram은 목적지 ip주소를 집어넣고 디폴트 게이트웨이의 ip주소로 arp를 이용하여 얻어낸 mac주소로 프레임을 만든다. 디폴트 게이트웨이에 패킷이 도착하면 ip주소를 활용하여 진짜 목적지의 mac주소를 arp를 알아내어 다시 캡슐화한후 전송한다.